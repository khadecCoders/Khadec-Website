<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="../../assets/img/favicon.png"
    />
    <link rel="icon" type="image/png" href="../../assets/img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Khadec Admin Dashboard</title>
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no"
      name="viewport"
    />
    <!--     Fonts and icons     -->
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"
      rel="stylesheet"
    />
    <link
      href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <!-- CSS Files -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/paper-dashboard.css?v=2.0.1" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../assets/demo/demo.css" rel="stylesheet" />
    <link
      href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>

  <body class="">
    <div class="wrapper">
      <div class="sidebar" data-color="white" data-active-color="danger">
        <div class="logo">
        <div class="top">
          <a class="simple-text logo-mini">
            <div class="logo-image-small">
              <img src="../assets/img/logo-small.png" />
            </div>
            <!-- <p>CT</p> -->
          </a>
          <a class="simple-text logo-small">
            Khadec Admin
            <!-- <div class="logo-image-big">
            <img src="../assets/img/logo-big.png">
          </div> -->
          </a>
        </div>
        <a  id="signed-user"></a>
        </div>
        <div class="sidebar-wrapper" style="overflow: hidden">
          <ul class="nav">
            <li class="active">
              <a href="./dashboard.html">
                <i class="bi bi-currency-dollar"></i>
                <p>Pricing</p>
              </a>
            </li>
            <li class="">
              <a href="./portfolio.html">
                <i class="bi bi-book-half"></i>
                <p>Portfolio</p>
              </a>
            </li>
            <li>
              <a href="./newsletters.html">
                <i class="fa fa-envelope"></i>
                <p>Newsletters</p>
              </a>
            </li>
            <li>
              <a href="./payment_subs.html">
                <i class="fa fa-credit-card"></i>
                <p>Payment Subscribers</p>
              </a>
            </li>
            <li class="active-pro" id="userLogout">
              <a>
                <i class="nc-icon nc-spaceship"></i>
                <p>Log Out</p>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="main-panel">
        <!-- Navbar -->
        <nav
          class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent"
        >
          <div class="container-fluid">
            <div class="navbar-wrapper">
              <div class="navbar-toggle">
                <button type="button" class="navbar-toggler">
                  <span class="navbar-toggler-bar bar1"></span>
                  <span class="navbar-toggler-bar bar2"></span>
                  <span class="navbar-toggler-bar bar3"></span>
                </button>
              </div>
              <a class="navbar-brand" href="javascript:;"
                >Dashboard</a
              >
            </div>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navigation"
              aria-controls="navigation-index"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
            </button>
            <div
              class="collapse navbar-collapse justify-content-end"
              id="navigation"
            >
              <form>
                <div class="input-group no-border">
                  <input
                    type="text"
                    value=""
                    class="form-control"
                    placeholder="Search..."
                  />
                  <div class="input-group-append">
                    <div class="input-group-text">
                      <i class="nc-icon nc-zoom-split"></i>
                    </div>
                  </div>
                </div>
              </form>
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link btn-magnify" href="javascript:;">
                    <i class="nc-icon nc-layout-11"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Stats</span>
                    </p>
                  </a>
                </li>
                <li class="nav-item btn-rotate dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="http://example.com"
                    id="navbarDropdownMenuLink"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="nc-icon nc-bell-55"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Some Actions</span>
                    </p>
                  </a>
                  <div
                    class="dropdown-menu dropdown-menu-right"
                    aria-labelledby="navbarDropdownMenuLink"
                  >
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </div>
                </li>
                <li class="nav-item">
                  <a class="nav-link btn-rotate" href="javascript:;">
                    <i class="nc-icon nc-settings-gear-65"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Account</span>
                    </p>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        <!-- End Navbar -->

        <!-- Main Content -->
        <div class="content" id="mainContent">
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title">Website Packages</h5>
                  <p class="card-category">Current Prices Packages</p>
                </div>
                <div class="card-body">
                  <section id="pricing" class="pricing section-bg wow fadeInUp">
                    <div class="container" data-aos="fade-up">
                      <div
                        class="row flex-items-xs-middle flex-items-xs-center"
                      >
                        <!-- Basic Plan  -->
                        <div
                          class="col-xs-12 col-lg-4"
                          data-aos="fade-up"
                          data-aos-delay="100"
                        >
                          <div class="card">
                            <div class="card-header">
                              <div
                                class=""
                                style="display: flex; align-items: center"
                              >
                                <div class="sign" style="font-size: 20px">
                                  $
                                </div>
                                <input
                                  class="form-control"
                                  type="text"
                                  value=""
                                  style="width: 80px"
                                  id="basic_price_val"
                                />
                              </div>
                            </div>
                            <div class="card-block">
                              <h4 class="card-title">Basic Plan</h4>
                              <ul class="list-group" id="basic_benefits">
                                <li class="list-group-item">
                                  <input type="checkbox" id="3chk1" checked disabled>
                                  <label for="3chk1" style="color: rgb(37, 37, 37);">Maximum of three pages.</label>
                                </li>
                                <li class="list-group-item">
                                  <input type="checkbox" id="3chk3" checked disabled>
                                  <label for="3chk3" style="color: rgb(37, 37, 37);">Light backend code.</label>
                                </li>
                              </ul>
                              <ul class="list-group" id="benefits_list"></ul>
                              <a class="btn" id="basicPlanBtn">Update Plan</a>
                            </div>
                          </div>
                        </div>

                        <!-- Regular Plan  -->
                        <div
                          class="col-xs-12 col-lg-4"
                          data-aos="fade-up"
                          data-aos-delay="100"
                        >
                          <div class="card">
                            <div class="card-header">
                              <div
                                class=""
                                style="display: flex; align-items: center"
                              >
                                <div class="sign" style="font-size: 20px">
                                  $
                                </div>
                                <input
                                  class="form-control"
                                  type="text"
                                  value=""
                                  style="width: 80px"
                                  id="business_price"
                                />
                              </div>
                            </div>
                            <div class="card-block">
                              <h4 class="card-title">Business Plan</h4>
                              <ul
                                class="list-group"
                                id="business_benefits"
                              >
                              <li class="list-group-item">
                                <input type="checkbox" id="3chk1" checked disabled>
                                <label for="3chk1" style="color: rgb(37, 37, 37);">Maximum of five pages.</label>
                              </li>
                              <li class="list-group-item">
                                <input type="checkbox" id="3chk3" checked disabled>
                                <label for="3chk3" style="color: rgb(37, 37, 37);">Moderate backend code.</label>
                              </li>
                            </ul>
                              <ul
                                class="list-group"
                                id="benefits_list_business"
                              ></ul>
                              <a class="btn" id="businessPlanBtn"
                                >Update Plan</a
                              >
                            </div>
                          </div>
                        </div>

                        <!-- Premium Plan  -->
                        <div
                          class="col-xs-12 col-lg-4"
                          data-aos="fade-up"
                          data-aos-delay="100"
                        >
                          <div class="card">
                            <div class="card-header">
                              <div
                                class=""
                                style="display: flex; align-items: center"
                              >
                                <div class="sign" style="font-size: 20px">
                                  $
                                </div>
                                <input
                                  class="form-control"
                                  type="text"
                                  value=""
                                  style="width: 80px"
                                  id="commerce_price"
                                />
                              </div>
                            </div>
                            <div class="card-block">
                              <h4 class="card-title">E-Commerce Plan</h4>
                              <ul
                                class="list-group"
                                id="commerce_benefits"
                              >
                              <li class="list-group-item">
                                <input type="checkbox" id="3chk1" checked disabled>
                                <label for="3chk1" style="color: rgb(37, 37, 37);">Unlimited number of pages.</label>
                              </li>
                              <li class="list-group-item">
                                <input type="checkbox" id="3chk3" checked disabled>
                                <label for="3chk3" style="color: rgb(37, 37, 37);">Intense backend code.</label>
                              </li>
                            </ul>
                              <ul
                                class="list-group"
                                id="benefits_list_commerce"
                              ></ul>
                              <a class="btn" id="commercePlanBtn"
                                >Update Plan</a
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </section>
                </div>
                <div class="card-footer">
                  <hr />
                  <div class="stats">
                    <!-- <i class="fa fa-history"></i> Updated 3 minutes ago -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <footer class="footer footer-black footer-white">
          <div class="container-fluid">
            <div class="row">
              <div class="credits ml-auto">
                <span class="copyright">
                  Â©
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  , made with <i class="fa fa-heart heart"></i> by Khadec
                  Technologies
                </span>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!--   Core JS Files   -->
    <script src="../assets/js/core/jquery.min.js"></script>
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>
    <!-- <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script> -->
    <!-- Chart JS -->
    <!-- <script src="../assets/js/plugins/chartjs.min.js"></script> -->
    <!--  Notifications Plugin    -->
    <script src="../assets/js/plugins/bootstrap-notify.js"></script>
    <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
    <script
      src="../assets/js/paper-dashboard.min.js"
      type="text/javascript"
    ></script>
    <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
    <!-- <script src="../assets/demo/demo.js"></script> -->
    <script>
      // $(document).ready(function() {
      //   // Javascript method's body can be found in assets/assets-for-demo/js/demo.js
      //   demo.initChartsPages();
      // });
    </script>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
      import {
        getDatabase,
        set,
        ref,
        update,
        onValue,
        push,
        remove,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
      import {
        getStorage,
        ref as storageRef,
        uploadBytes,
        getDownloadURL,
        uploadBytesResumable,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCuyHGrJ_7WMP_V0QGbbZWOYDS_oVA_gaA",
        authDomain: "khadec-tech.firebaseapp.com",
        databaseURL: "https://khadec-tech-default-rtdb.firebaseio.com",
        projectId: "khadec-tech",
        storageBucket: "khadec-tech.appspot.com",
        messagingSenderId: "623072304859",
        appId: "1:623072304859:web:bbb275fbd6773aa6cfb6fe"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth(app);
      const storage = getStorage(app);

      onAuthStateChanged(auth, (user) => {
        if(user){
          var uid = user.uid;
          var myEmail = user.email;

          document.getElementById('signed-user').innerHTML = myEmail;
        }else{
          window.location.href = '../../adminLogin.html'
        }
      })

      const basicPrice = ref(database, "packages/Basic");
      onValue(basicPrice, (snapshot) => {
        localStorage.setItem("Basic-Package", JSON.stringify(snapshot));
      });

      const businessPrice = ref(database, "packages/Business");
      onValue(businessPrice, (snapshot) => {
        localStorage.setItem("Business-Package", JSON.stringify(snapshot));
      });

      const commercePrice = ref(database, "packages/Commerce");
      onValue(commercePrice, (snapshot) => {
        localStorage.setItem("ECommerce-Package", JSON.stringify(snapshot));
      });
      
    const subscribersRef = ref(database, 'subscribers/');
      onValue(subscribersRef, (snapshot) => {
        localStorage.setItem('Subscribers', JSON.stringify(snapshot))
      });

      const localBasicPackage = JSON.parse(
        localStorage.getItem("Basic-Package")
      );
      const localBusinessPackage = JSON.parse(
        localStorage.getItem("Business-Package")
      );
      const localEcommPackage = JSON.parse(
        localStorage.getItem("ECommerce-Package")
      );

      // load basic prices
      document.getElementById(
        "basic_price_val"
      ).value = localBasicPackage["SEO"].price;
      let L = 0;
      for (let basicPrice in localBasicPackage) {
        let id = L++;
        let { name, available } = localBasicPackage[basicPrice];
        document.getElementById("benefits_list").innerHTML += `
        <li class="list-group-item">
            ${
              available
                ? '<input class="the_basic_prices" type="checkbox" id="basic' +
                  id +
                  '" value="' +
                  name +
                  '" checked>'
                : '<input class="the_basic_prices" value="' +
                  name +
                  '" type="checkbox" id="basic' +
                  id +
                  '">'
            }
            <label for="basic${id}" style="color: rgb(37, 37, 37);">${name}</label>
          </li>
      `;
      }

      // load business prices
      document.getElementById(
        "business_price"
      ).value = localBusinessPackage["SEO"].price;
      let k = 0;
      for (let Price in localBusinessPackage) {
        let id = k++;
        let { name, available } = localBusinessPackage[Price];
        document.getElementById("benefits_list_business").innerHTML += `
        <li class="list-group-item">
            ${
              available
                ? '<input type="checkbox" class="the_business_prices" id="busi' +
                  id +
                  '" value="' +
                  name +
                  '" checked>'
                : '<input type="checkbox" value="' +
                  name +
                  '" class="the_business_prices" id="busi' +
                  id +
                  '">'
            }
            <label for="busi${id}" style="color: rgb(37, 37, 37);">${name}</label>
          </li>
      `;
      }

      // load e-comm prices
      document.getElementById(
        "commerce_price"
      ).value = localEcommPackage["SEO"].price;
      let j = 0;
      for (let Price in localEcommPackage) {
        let id = j++;
        let { name, available } = localEcommPackage[Price];
        document.getElementById("benefits_list_commerce").innerHTML += `
        <li class="list-group-item">
            ${
              available
                ? '<input type="checkbox" class="the_commerce_prices" value="' +
                  name +
                  '" id="comm' +
                  id +
                  '" checked>'
                : '<input type="checkbox" class="the_commerce_prices" value="' +
                  name +
                  '" id="comm' +
                  id +
                  '">'
            }
            <label for="comm${id}" style="color: rgb(37, 37, 37);">${name}</label>
          </li>
      `;
      }

      // Update basic packages
      document.getElementById("basicPlanBtn").addEventListener("click", (e) => {
        let basic_benefits = document.querySelectorAll(".the_basic_prices");

        for (let benefit in basic_benefits) {
          let { checked, defaultValue } = basic_benefits[benefit];

          if (checked) {
            set(ref(database, "packages/Basic/" + defaultValue), {
              name: defaultValue,
              available: checked,
              price: document.getElementById("basic_price").value,
            });
          } else {
            set(ref(database, "packages/Basic/" + defaultValue), {
              name: defaultValue,
              available: checked,
              price: document.getElementById("basic_price").value,
            });
          }
        }
        alert("Success");
      });

      // Update business packages

      document
        .getElementById("businessPlanBtn")
        .addEventListener("click", (e) => {
          let business_benefits = document.querySelectorAll(
            ".the_business_prices"
          );
          console.log(business_benefits);

          for (let benefit in business_benefits) {
            let { checked, defaultValue } = business_benefits[benefit];

            if (checked) {
              set(ref(database, "packages/Business/" + defaultValue), {
                name: defaultValue,
                available: checked,
                price: document.getElementById("business_price").value,
              });
            } else {
              set(ref(database, "packages/Business/" + defaultValue), {
                name: defaultValue,
                available: checked,
                price: document.getElementById("business_price").value,
              });
            }
          }
          alert("Success");
        });

      // Update commerce packages

      document
        .getElementById("commercePlanBtn")
        .addEventListener("click", (e) => {
          let commerce_benefits = document.querySelectorAll(
            ".the_commerce_prices"
          );

          for (let benefit in commerce_benefits) {
            let { checked, defaultValue } = commerce_benefits[benefit];

            if (checked) {
              set(ref(database, "packages/Commerce/" + defaultValue), {
                name: defaultValue,
                available: checked,
                price: document.getElementById("commerce_price").value,
              });
            } else {
              set(ref(database, "packages/Commerce/" + defaultValue), {
                name: defaultValue,
                available: checked,
                price: document.getElementById("commerce_price").value,
              });
            }
          }
          alert("Success");
        });

      document.getElementById("userLogout").addEventListener("click", () => {
        signOut(auth)
          .then(() => {
            // Sign-out successful.
            window.location.href = "../../adminLogin.html";
          })
          .catch((error) => {
            // An error happened.
          });
      });
    </script>
  </body>
</html>
